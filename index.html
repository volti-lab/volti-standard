<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Volti Enterprise - í†µí•© ë¶„ì„ í”Œë«í¼</title>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <style>
        :root { --primary: #0070f3; --dark: #111; --green: #00ff00; --accent: #ff4d4d; }
        body { font-family: 'Pretendard', sans-serif; background: #f0f2f5; margin: 0; color: #333; }
        
        /* ì‹¤ì‹œê°„ í‹°ì»¤ (ì„¸ê³„ ì§€í‘œ) */
        .top-bar { background: var(--dark); color: var(--green); padding: 10px; font-family: monospace; font-size: 13px; display: flex; gap: 50px; overflow: hidden; }
        .ticker-wrap { display: flex; animation: scroll 40s linear infinite; }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        .main-grid { display: grid; grid-template-columns: 350px 1fr 300px; gap: 20px; padding: 20px; max-width: 1600px; margin: auto; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h3 { margin-top: 0; border-left: 4px solid var(--primary); padding-left: 10px; font-size: 16px; }

        /* ì…ë ¥ í¼ */
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; cursor: pointer; font-weight: bold; }
        
        /* ë³€ë™ ì§€í‘œ ìŠ¤íƒ€ì¼ */
        .live-indicator { display: flex; justify-content: space-between; font-size: 13px; padding: 8px 0; border-bottom: 1px dotted #eee; }
        .val { color: var(--accent); font-weight: bold; }
        .log-box { font-size: 12px; color: #666; background: #f9f9f9; padding: 10px; border-radius: 5px; margin-top: 10px; display: none; }

        /* ê¸°ì—… ê°€ì´ë“œ ì„¹ì…˜ */
        .guide-box { background: #eef6ff; padding: 15px; border-radius: 8px; font-size: 14px; }
    </style>
</head>
<body>

<div class="top-bar">
    <div class="ticker-wrap" id="global-ticker">
        </div>
</div>

<div class="main-grid">
    <div class="col">
        <div class="card">
            <h3>âš¡ ê°€ì¹˜ ë¶„ì„ ì‹¤í–‰</h3>
            <input type="text" id="address" placeholder="ë°œì „ì†Œ ì£¼ì†Œ ì„ íƒ" readonly onclick="findAddress()">
            <input type="number" id="kwh" placeholder="ì—°ê°„ ë°œì „ëŸ‰(kWh)">
            <label style="font-size:12px; color:#666;">ì¤€ê³µ(ìƒì‚° ì‹œì‘) ì‹œì </label>
            <select id="months">
                <option value="1">ìµœê·¼ 1ê°œì›” ì´ë‚´ (ì‹ ì¶•)</option>
                <option value="6">6ê°œì›” ë¯¸ë§Œ</option>
                <option value="12">1ë…„ ë¯¸ë§Œ</option>
                <option value="24">2ë…„ ì´ìƒ</option>
            </select>
            <button onclick="calculateVT()">ë¶„ì„ ì—”ì§„ ê°€ë™</button>
            
            <div id="result" style="display:none; margin-top:20px;">
                <div class="guide-box">
                    <strong>ìµœì¢… ë¶„ì„ ê°€ì¹˜: <span id="res-vt" class="val">0</span> VT</strong><br>
                    í™˜ì‚° ìˆ˜ìµ: â‚©<span id="res-cash">0</span>
                </div>
                <div class="log-box" id="analysis-log">
                    <strong>[ì—”ì§„ ì ìš© ë³€ë™ê°’]</strong><br>
                    <span id="log-details"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="col">
        <div class="card">
            <h3>ğŸ“Š ì‹¤ì‹œê°„ ë³€ë™ ì§€í‘œ (êµ­ë‚´/ì„¸ê³„)</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <p style="font-weight:bold; font-size:14px;">[êµ­ë‚´ ê³„í†µ ë°ì´í„°]</p>
                    <div class="live-indicator">ì§€ì—­ ì†ì‹¤ë¥ (L) <span class="val" id="v-l">1.250</span></div>
                    <div class="live-indicator">íƒ„ì†Œ ì§‘ì•½ë„(C) <span class="val" id="v-c">1.100</span></div>
                    <div class="live-indicator">ì‹¤ì‹œê°„ SMP <span class="val" id="v-smp">242.1</span></div>
                </div>
                <div>
                    <p style="font-weight:bold; font-size:14px;">[ì„¸ê³„ ê°€ê²© ì§€í‘œ]</p>
                    <div class="live-indicator">EU íƒ„ì†Œê¶Œ(ETS) <span class="val" id="v-ets">â‚¬64.2</span></div>
                    <div class="live-indicator">IRENA ì¬ìƒì§€ìˆ˜ <span class="val" id="v-irena">104.2</span></div>
                    <div class="live-indicator">WTI ìœ ê°€ <span class="val" id="v-wti">$72.4</span></div>
                </div>
            </div>
        </div>
        <div class="card">
            <h3>ğŸ“ˆ ê°€ì¹˜ ë³€ë™ ì¶”ì´ (ìµœê·¼ 24ì‹œê°„)</h3>
            <div style="height:150px; background:#f9f9f9; display:flex; align-items:flex-end; justify-content:space-around; padding:10px;">
                <div style="width:20px; background:var(--primary); height:60%;"></div>
                <div style="width:20px; background:var(--primary); height:80%;"></div>
                <div style="width:20px; background:var(--primary); height:75%;"></div>
                <div style="width:20px; background:var(--primary); height:90%;"></div>
                <div style="width:20px; background:var(--accent); height:95%;"></div>
            </div>
        </div>
    </div>

    <div class="col">
        <div class="card">
            <h3>ğŸ¢ ê¸°ì—… êµ¬ë§¤ ê°€ì´ë“œ</h3>
            <p style="font-size:13px; color:#666;">ë§¤ì¶œ ê·œëª¨ ëŒ€ë¹„ ê¶Œì¥ VT êµ¬ë§¤ëŸ‰</p>
            <input type="number" id="revenue-input" placeholder="ì—°ê°„ ë§¤ì¶œì•¡(ì–µì›)" oninput="updateGuide()">
            <div class="guide-box" id="guide-result">
                ë§¤ì¶œì•¡ì„ ì…ë ¥í•˜ë©´ íƒ„ì†Œì¤‘ë¦½ ê°€ì´ë“œë¼ì¸ì´ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
            <ul style="font-size:12px; padding-left:15px; color:#555; line-height:1.6;">
                <li>RE100 ë‹¬ì„± ì‹œ ë§¤ì¶œ 1ì–µë‹¹ ì•½ 150VT ê¶Œì¥</li>
                <li>ESG ê³µì‹œ ëŒ€ì‘ ì‹œ 25% ê°€ì¤‘ì¹˜ ë¶€ì—¬</li>
            </ul>
        </div>
    </div>
</div>

<script>
    // 1. ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸
    function updateLive() {
        const smp = (240 + Math.random()*5).toFixed(1);
        const ets = (64 + Math.random()*2).toFixed(1);
        document.getElementById('v-smp').innerText = smp;
        document.getElementById('v-ets').innerText = `â‚¬${ets}`;
        
        const ticker = document.getElementById('global-ticker');
        const content = `[KOREA SMP] â‚©${smp} | [EU ETS] â‚¬${ets} | [US REC] $34.2 | [GOLD] $2,042 | [VIX PRICE] â‚©250.2 | `;
        ticker.innerText = content + content; // ë°˜ë³µ íš¨ê³¼
    }
    setInterval(updateLive, 2000);

    // 2. ê¸°ì—… êµ¬ë§¤ ê°€ì´ë“œ ê³„ì‚°
    function updateGuide() {
        const rev = document.getElementById('revenue-input').value;
        const res = document.getElementById('guide-result');
        if(!rev) return;
        const targetVT = (rev * 150).toLocaleString();
        res.innerHTML = `<strong>ê¶Œì¥ êµ¬ë§¤ëŸ‰: ${targetVT} VT</strong><br><small>ì—°ê°„ ë§¤ì¶œ ëŒ€ë¹„ íƒ„ì†Œìƒì‡„ ëª©í‘œì¹˜</small>`;
    }

    // 3. ë¶„ì„ ì‹¤í–‰
    async function calculateVT() {
        const kwh = document.getElementById('kwh').value;
        const addr = document.getElementById('address').value;
        const months = document.getElementById('months').value;
        if(!addr || !kwh) return alert("ì£¼ì†Œì™€ ë°œì „ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”.");

        const res = await fetch(`/api/calculate?kwh=${kwh}&addr=${addr}&months=${months}`);
        const data = await res.json();

        document.getElementById('result').style.display = 'block';
        document.getElementById('res-vt').innerText = data.vt;
        document.getElementById('res-cash').innerText = data.revenue;
        
        // ë³€ë™ê°’ ë¡œê·¸ í‘œì‹œ
        const logBox = document.getElementById('analysis-log');
        logBox.style.display = 'block';
        document.getElementById('log-details').innerHTML = 
            `ì†ì‹¤ë¥ (L): ${data.log.L} | ì‹œê°„ëŒ€(T): ${data.log.T} | íƒ„ì†Œ(C): ${data.log.C} | ì§€ì—­(R): ${data.log.R} | ë…¸í›„ë„: ${data.log.Age}`;
    }

    function findAddress() { new daum.Postcode({ oncomplete: d => document.getElementById('address').value = d.address }).open(); }
    updateLive();
</script>
</body>
</html>