<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volti Standard - Real-time Expert Dashboard</title>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <style>
        :root { --primary: #0070f3; --dark: #1a1a1a; --light: #f5f7f9; --accent: #e63946; --green: #00ff00; }
        body { font-family: 'Inter', sans-serif; background: var(--light); color: var(--dark); margin: 0; line-height: 1.6; }
        
        /* 1. ë§¤ì´ˆ ë³€ë™í•˜ëŠ” ìƒë‹¨ ì „ê´‘íŒ */
        .vix-ticker { background: var(--dark); color: var(--green); padding: 12px 0; overflow: hidden; white-space: nowrap; font-family: monospace; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #333; }
        .ticker-content { display: inline-block; padding-left: 100%; animation: ticker 40s linear infinite; }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        header { padding: 30px; text-align: center; background: white; border-bottom: 1px solid #ddd; }
        .main-container { max-width: 1200px; margin: 30px auto; padding: 0 20px; display: grid; grid-template-columns: 1fr 1.2fr; gap: 30px; }
        
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); height: fit-content; }
        h2 { font-size: 1.2em; color: var(--primary); border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-top: 0; }

        /* ì•„ì½”ë””ì–¸ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .details-box { margin-top: 10px; border: 1px solid #eee; border-radius: 8px; }
        .details-header { background: #f8f9fa; padding: 12px 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 0.9em; }
        .details-content { padding: 15px; display: none; background: white; font-size: 0.85em; border-top: 1px solid #eee; }
        .live-val { color: var(--accent); font-weight: bold; font-family: monospace; }

        input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="vix-ticker">
    <div class="ticker-content" id="live-ticker">
        ë¡œë”© ì¤‘... ì‹¤ì‹œê°„ VIX ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤.
    </div>
</div>

<header>
    <h1>Volti Standard Expert</h1>
    <p>ì‹¤ì‹œê°„ ë°ì´í„° í”¼ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—ë„ˆì§€ ê°€ì¹˜ë¥¼ ì •ë°€í•˜ê²Œ ì‚°ì¶œí•©ë‹ˆë‹¤.</p>
</header>

<div class="main-container">
    <div class="card">
        <h2>VT ê°€ì¹˜ ë¶„ì„ ì—”ì§„</h2>
        <input type="text" id="address" placeholder="ë°œì „ì†Œ ì£¼ì†Œ ê²€ìƒ‰" readonly onclick="findAddress()">
        <button onclick="findAddress()" style="background:#666;">ì£¼ì†Œ ê²€ìƒ‰</button>
        <input type="number" id="kwh" placeholder="ë°œì „ëŸ‰ ì…ë ¥ (kWh)">
        <button onclick="calculateVT()">ê°€ì¹˜ ë¶„ì„ ì‹¤í–‰</button>
        
        <div id="result" style="display:none; margin-top:20px; padding:15px; background:#eef6ff; border-radius:8px; border:1px solid var(--primary);"></div>
    </div>

    <div class="card">
        <h2>ì‹¤ì‹œê°„ ë³€ë™ ì§€í‘œ (Live Factors)</h2>
        
        <div class="details-box">
            <div class="details-header" onclick="toggleDetails('f1')">
                <span>ğŸ“Š ê³„í†µ íš¨ìœ¨ ë° ìœ„ì¹˜ ê³„ìˆ˜ (L)</span>
                <span id="f1-btn">+</span>
            </div>
            <div id="f1" class="details-content">
                â€¢ í˜„ì¬ ì†¡ì „ ì†ì‹¤ë¥ : <span class="live-val" id="val-loss">0.042%</span><br>
                â€¢ ì§€ì—­ ìˆ˜ìš” ë°€ì§‘ë„: <span class="live-val" id="val-demand">92% (High)</span><br>
                â€¢ ìœ„ì¹˜ ê°€ì¤‘ì¹˜ ì ìš©: <span class="live-val">x1.12</span>
            </div>
        </div>

        <div class="details-box">
            <div class="details-header" onclick="toggleDetails('f2')">
                <span>â± ì‹œê°„ëŒ€ë³„ SMP í•œê³„ ê°€ê²© (T)</span>
                <span id="f2-btn">+</span>
            </div>
            <div id="f2" class="details-content">
                â€¢ í˜„ì¬ ì „ë ¥ ì‹œì¥ê°€: <span class="live-val" id="val-smp">â‚©242.5 / kWh</span><br>
                â€¢ í”¼í¬ ì‹œê°„ëŒ€ ì—¬ë¶€: <span class="live-val">Peak Time</span><br>
                â€¢ ì‹œê°„ ê°€ì¤‘ì¹˜ ì ìš©: <span class="live-val">x1.50</span>
            </div>
        </div>

        <div class="details-box">
            <div class="details-header" onclick="toggleDetails('f3')">
                <span>ğŸŒ ì‹¤ì‹œê°„ íƒ„ì†Œ ì§‘ì•½ë„ (C)</span>
                <span id="f3-btn">+</span>
            </div>
            <div id="f3" class="details-content">
                â€¢ Grid íƒ„ì†Œ ë°°ì¶œëŸ‰: <span class="live-val" id="val-carbon">425g CO2/kWh</span><br>
                â€¢ í™”ì„ì—°ë£Œ ëŒ€ì²´ ê°€ì¹˜: <span class="live-val" id="val-c-price">â‚©14,200 / ton</span><br>
                â€¢ íƒ„ì†Œ ê°€ì¤‘ì¹˜ ì ìš©: <span class="live-val">x1.08</span>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. ë§¤ì´ˆ ë³€ë™í•˜ëŠ” ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜
    function updateLiveNumbers() {
        const cities = [
            { name: "ì„œìš¸", price: 250 }, { name: "ë² ë¥¼ë¦°", price: 315 },
            { name: "ë‰´ìš•", price: 285 }, { name: "ì œì£¼", price: 292 }
        ];
        
        // ìƒë‹¨ ì „ê´‘íŒ ì—…ë°ì´íŠ¸
        let tickerText = "[LIVE VIX KRW] ";
        cities.forEach(c => {
            const vari = (Math.random() * 2 - 1).toFixed(2);
            tickerText += `${c.name}: â‚©${(c.price + parseFloat(vari)).toFixed(2)} (${vari > 0 ? '+' : ''}${vari}) | `;
        });
        document.getElementById('live-ticker').innerText = tickerText + tickerText; // ë°˜ë³µì„ ìœ„í•´ ë‘ë²ˆ

        // ì„¸ë¶€ ìˆ˜ì¹˜ ì—…ë°ì´íŠ¸
        if(document.getElementById('val-loss')) {
            document.getElementById('val-loss').innerText = (Math.random() * 0.1).toFixed(3) + "%";
            document.getElementById('val-smp').innerText = "â‚©" + (240 + Math.random() * 10).toFixed(1) + " / kWh";
            document.getElementById('val-carbon').innerText = (420 + Math.random() * 20).toFixed(0) + "g CO2/kWh";
        }
    }
    setInterval(updateLiveNumbers, 1000);

    // 2. ì•„ì½”ë””ì–¸ í† ê¸€
    function toggleDetails(id) {
        const content = document.getElementById(id);
        const btn = document.getElementById(id + '-btn');
        if (content.style.display === "block") {
            content.style.display = "none";
            btn.innerText = "+";
        } else {
            content.style.display = "block";
            btn.innerText = "-";
        }
    }

    // 3. ì£¼ì†Œ ì°¾ê¸°
    function findAddress() {
        new daum.Postcode({
            oncomplete: function(data) {
                document.getElementById('address').value = data.address;
            }
        }).open();
    }

    // 4. ê°€ì¹˜ ë¶„ì„ ì‹¤í–‰ (API ì—°ê²° ë³µêµ¬)
    async function calculateVT() {
        const kwh = document.getElementById('kwh').value;
        const addr = document.getElementById('address').value;
        if(!addr || !kwh) { alert("ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

        try {
            const response = await fetch(`/api/calculate?kwh=${kwh}&addr=${addr}`);
            const data = await response.json();
            
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3 style="margin:0; color:var(--primary);">ë¶„ì„ ê²°ê³¼ (Verified)</h3>
                <p>ìµœì¢… ì‚°ì¶œ ê°€ì¹˜: <b style="font-size:1.4em;">${data.vt} VT</b></p>
                <p>í•œí™” í™˜ì‚° ìˆ˜ìµ: <b style="color:var(--accent); font-size:1.4em;">â‚©${data.revenue}</b></p>
                <small style="color:#666;">* ì‹¤ì‹œê°„ ê³„í†µ ì†ì‹¤ ë° íƒ„ì†Œ ë†ë„ê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.</small>
            `;
        } catch (e) {
            alert("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. api/calculate.py íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
        }
    }
</script>

</body>
</html>